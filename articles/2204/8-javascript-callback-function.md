# 【JavaScriptの入門】コールバック関数

多くのプログラミング言語は、処理の汎用性を高めるために、コールバックという仕組みを取り入れています。
JavaScriptでも、柔軟な処理を行うためにコールバック関数が使われています。

今回は、コールバック関数とは何か、例をもとに解説していきます。

## コールバック関数
JavaScriptでは関数はオブジェクトの一つであり、関数を他の関数の引数として渡すことができます。
コールバック関数は、ある関数を呼び出す際に、その関数の引数に指定される別の関数のことです。
また、コールバック関数を受け取ったり返したりする関数のことを高階関数と呼びます。
```javascript
function 高階関数(コールバック関数) {
  コールバック関数();
}
```

少し複雑に聞こえるかもしれませんが、整理すると次のような仕組みになっています。
1. 関数は値であり、オブジェクト型の一つ
2. 関数は値を受け取ることができる
3. 関数に関数を渡すことができる
4. 関数に渡される関数はコールバック関数
5. コールバック関数を使う関数は高階関数

どうでしょうか。
以下で使い方を解説するので、ここではイメージできていれば問題ありません。

## コールバック関数の使い方
ここからは、コールバック関数の使い方を見ていきましょう。

### 関数を別々に定義する
まずは、2つの関数を別々に定義し、その内の1つを呼び出す際にもう片方の関数を引数として指定するパターンを見ていきます。
```javascript
関数A(関数B);
```

次のコードには、高階関数の```funcA```とコールバック関数の```funcB```があります。
```javascript
// 関数1 → funcBを引数に受け取れる（高階関数）
function funcA(text) {
  text(); // funcBの処理
  console.log('メッセージを受け取りました'); // funcAの処理
}

// 関数2 → funcAの呼び出し時に引数に指定される（コールバック関数になる）
function funcB() {
  console.log('こんにちは');
}

// funcAの呼び出し → 引数にfuncBを指定
funcA(funcB);

// "こんにちは"
// "メッセージを受け取りました"
```
```funcA```の呼び出し時に、引数に```funcB```を指定しています。
そして、```funcA```の中では、```text```という引数で扱われています。
```text()```により、```funcB```内に記述した処理が行われます。

上記は関数宣言が使われていますが、関数式やアロー関数でもコールバック関数を使用することができます。

### 引数に直接関数を記述する
毎回関数を定義し、その関数をコールバック関数として渡すのは手間がかかります。
そういった場合に、コールバック関数を引数の中に直接記述することができます。
```javascript
関数(関数の定義);
```

次のコードを見てください。
コールバック関数となる無名関数を引数の中にその場で定義します。
```javascript
function funcA(text) {
  text();
  console.log('メッセージを受け取りました');
}

// funcAの呼び出し → 引数に無名関数（関数式）を定義
funcA(function() { 
  console.log('こんにちは');
});

// "こんにちは"
// "メッセージを受け取りました"
```
```funcA(...)```の呼び出しの中で、関数が定義されています。```function(){...}```がコールバック関数です。
処理内容が少ない場合、引数に直接関数を記述することで、2つの関数を別々に定義するよりも記述が少なくなります。

また、関数式を使用することでより関数名を記述しなくて済みます。
コールバックの多くの場面では、関数宣言と合わせて関数式やアロー関数が活用されるため、使えるようになると便利です。

アロー関数を使った場合、次のように書くことができます。
```javascript
const funcA = (text) => {
  text();
  console.log('メッセージを受け取りました');
};

// funcAの呼び出し → 引数に無名関数（アロー関数）を定義
funcA(() => {
  console.log('こんにちは');
});

// "こんにちは"
// "メッセージを受け取りました"
 ```

## コールバック関数が使われる場面
コールバック関数は、```setTimeout```関数を使った処理で良く使われます。
```setTimeout```関数は、JavaScriptに組み込まれている関数で、一定時間後に特定の処理を行います。一言で言うとタイマーのような機能です。

```setTimeout```関数の第一引数に関数、第二引数にミリ秒単位で秒数を指定します。
```javascript
setTimeout(関数, 秒数);
 ```

実際のコードを見てみましょう。
```javascript
function sayHi() {
  console.log('こんにちは');
}

setTimeout(sayHi, 3000); // 3秒後に出力

// "こんにちは"
 ```
実行してみると3秒後に```'こんにちは'```と出力されるはずです。

また、無名関数を使うこともできます。
```javascript
setTimeout(function() {
  console.log('こんにちは');
}, 3000); 

// "こんにちは"
```
同様に、3秒後に```'こんにちは'```と出力されます。

コールバック関数は、非同期処理においても利用されます。
非同期処理は応用的な内容になるため、ここでは詳しい説明は省略しますが、以下の記事で解説しているので、参考にしてください。

## まとめ
今回は、コールバック関数について解説しました。

```plain
// ポイント
* コールバック関数は、引数として渡される関数のこと
* 高階関数は、コールバック関数を引数として使う関数のこと
* 関数A(関数B)や関数(関数の定義)のように使用できる
* setTimeoutや非同期処理で利用される
```

コールバック関数の書き方は人によっても異なるため、さまざまな関数定義の方法で使えるように身に付けていきましょう。

## 合わせて読みたいJavaScript関数の関連記事
第1回：[関数と宣言](https://tcd-theme.com/2022/04/javascript-function-declaration.html)
第2回：[関数と引数](https://tcd-theme.com/2022/04/javascript-function-parameter-argument.html)
第3回：[関数と戻り値](https://tcd-theme.com/2022/04/javascript-function-return.html)
第4回：[関数式](https://tcd-theme.com/2022/04/javascript-function-expressions.html)
第5回：[関数オブジェクト](https://tcd-theme.com/2022/04/javascript-function-is-object.html)
第6回：[argumentsオブジェクト](https://tcd-theme.com/2022/04/javascript-arguments-object.html)
第7回：[アロー関数](https://tcd-theme.com/2022/04/javascript-arrow-function-basic.html)
第8回：[コールバック関数](https://tcd-theme.com/2022/04/javascript-callback-function.html)（当記事）


